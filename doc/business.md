# Changing the pricing policy for AwardWallet Business interface

https://redmine.awardwallet.com/issues/10954

## Описание

**Отказ от двух прошлых тарифов "Regular Business Account" ($100 per 12 months per 25 users) и
"Business Plus Account" ($250 per 12 months per 25 users).**

#### Баланс

Каждый бизнес AW имеет свой баланс. Ранее балансом считалась сумма, уплаченная за 25, 50, 75, 100, 125
и т.д. пользователей на 1 год вперед, с вычетом уже израсходованной части
(например, оплатил Business Plus Account на год за 50 юзеров, баланс $500, через полгода - $250 и через год
 баланс - $0).

Новый баланс бизнес пополняет отдельно и расходует его по своему усмотрению. В отличие от старого бизнеса,
новый может иметь отрицательный баланс.

Баланс можно расходовать на добавление новых пользователей (family members и connected),
раздачу среди своих connected AW Plus или за букинг (за каждый завершенный букзапрос).

* Стоимость добавления любого юзера - $5 в год.
* Стоимость AW Plus - $5 в год.
* Стоимость перевода букинг запроса в статус Booked или Paid - $20

При удалении связи с пользователем деньги за добавление возвращаются бизнесу с вычетом уже потраченной части
за год.
Chargeback апгрейта до AW Plus невозможен. Так же смена статуса букзапроса с Booked или Paid на Open не
возвращает деньги. Повторное открытие и смена статуса букзапроса на Booked или Paid не снимает деньги с
баланса.

> Что будет с букзапросами, которые уже открыты на момент выката новой политики бизнеса? По идее с них
мы не должны брать деньги.

> Останутся ли вычеты с забуканых запросов за пользователя пришедшего от нас или от букера? Помнится 25% и
 4% от Fee соответственно для BookYourAward. Выходит $20 + 4-25% от Fee?

> Необходимо будет как то менять отчеты https://awardwallet.com/manager/reports/payments.php,
https://awardwallet.com/manager/list.php?Schema=AbTransaction? Или новый отчет о пополнении
баланса.

##### Отрицательный баланс

Блокирует добавление новых пользователей и их апгрейт до AW Plus. Не влияет на букинг. Букер
может закрывать букзапросы уходя бесконечно в минус.

##### Скидка

2 вида скидки: на добавление юзеров и на смену статуса букзапроса (Booked или Paid)

#### Триал

После регистрации бизнеса дается Trial период на 3 месяца. В течение этого периода вместо баланса
показывается "Trial". Существующие бизнесы так же получают триал на 3 месяца.

Бизнес в течение триал периода может добавлять **любое кол-во пользователей (family and connected)**.
Триал не распространяется на букинг и раздачу AW Plus (платить придется).

> Будет ли возможность пополнить баланс в течение триал периода? Если да, то как повлияет это на
индикатор баланса и надпись Trial?

> Возможно ли дать AW Plus будучи в триале? Как это
скажется на счетчике баланса?

###### Возможно...

* Информирование бизнеса о начале и окончании триал-периода (2 поля в базе). Вероятно можно сделать
информирование заранее об окончании.
* Не нужна эта надпись Trial в поле баланса наверху страницы, но нужна другая информашка о том, что
идет триал период.

#### Блокировка

> Если у бизнеса меньше чем $5 на счету то мы блокируем все основые функции бизнес акаунта,
например попапом или еще как-то так. Т.е. закрываем списки - Accounts, Trips. Кроме букинга.

> Наверное речь об отрицательном балансе? Пример, кончается триал период
> и бизнесу дают понять, что за 5 юзеров, которых он добавил в триале, ему надо заплатить
> $25. Он пополняет баланс ровно на столько же и тут же юзеры все становятся валидными,
> но баланс = 0. И за что его будут блокировать? Добавление нового юзера разве что.

#### Транзакции

Бизнесу доступна страница, на которой расписано куда расходуются его денежные средства.
На ней показывается информация о:
 * текущем балансе
 * статусе триал
 * фиксированной стоимости подключенных к бизнесу юзеров (кол-во × $5 - BusinessInfo.Discount)
 * вероятной стоимости AW Plus для выбранных юзеров
 * расходах по букингу (закрытии запросов)

Так же на странице указываем постранично все платежные транзакции

> Сортировка по убыванию Date?

> Можно ли сортировать по другим колонкам?

> Как выглядят транзакции, созданные в триале? Тоже самое, только Amount = $0?

###### Возможно...

* Выводить на странице инфу о списаниях с букера "4-25% Fee"?


## База

#### BusinessInfo

Поле             | Тип            | Описание
---------------- | -------------- | ----------------
BusinessInfoID   | INT            |
UserID           | INT            | Ссылка на бизнес-юзера
Balance          | DOUBLE         | Баланс бизнеса
Discount         | INT            | Скидка на добавление юзера (приконект или family member).
EndTrial         | DATETIME       | Дата окончания триала


#### AbBookerInfo

Поле             | Тип            | Описание
---------------- | -------------- | ----------------
...              | ...            | ...
Discount         | INT            | Скидка на перевод запроса в статусы Booked или Paid
...              | ...            | ...

#### BusinessTransaction

Поле                  | Тип            | Описание
--------------------- | -------------- | ----------------
BusinessTransactionID | INT            |
UserID                | INT            | ID бизнеса
CreateDate            | DATETIME       | Дата создания
Type                  | TINYINT        | Тип транзакции (добавление юзера, удаление, закрытие букзапроса и т.д.)
Amount                | DOUBLE         | Сумма транзакции
Balance               | DOUBLE         | Остаток на балансе после вычета
SourceID              | INT            | UserAgent, AbRequestID
SourceDesc            | VARCHAR        | Тест, который показывается при формировании description, даже когда SourceID не существует

SourceID необходим, чтобы по связке "Type - SourceID" найти присоединенного, обновленного юзера,
закрытый букзапрос.
Предварительные типы транзакций:
* "New member added - Mark Larson" - добавление нового мембера. Сохраняем SourceID = UserAgentID и
SourceDesc = FullName. Теперь можно узнать когда мембер станет невалидным по BusinessTransaction.CreateDate + 1 year.
* "Membership renewed - Mark Larson" - продление валидности.
* "Member deleted - Mark Larson" - удаление юзера.
* "Upgraded John Smith to AwardWallet Plus" - апгрейд до AW Plus
* "Booking Request #1234 closed" - букзапрос закрыт

Description транзакции не сохраняется, по типу транзакции мы сами формируем переведенный текст
с использованием SourceDesc.


## TODO

* Правка FAQ
* Миграция существующих бизнесов
