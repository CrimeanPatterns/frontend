# Смена пороля аккаунта
В наших парсерах мы поддерживаем новый функционал смены пароля от аккаунты, для этого необходимо писать реализацию методов. Сейчас есть возможность такого функционала при серверной проверке через Loyalty, реализация через extension будет позже, поскольку серверный функционал мы можем давать нашим партнерам.

## Реализация
### Включение провайдера
В схему Provider добавлены два новых поля:

Имя                     | Тип        | Описание
----------------------- | ---------- | ---------
CanChangePasswordServer | boolean    | Возможность смены паролей аккаунтов через Loyalty
CanChangePasswordClient | boolean    | Возможность смены паролей аккаунтов через extension

Перед написанием серверного парсера зачекайте галку `CanChangePasswordServer` у себя в локальной базе.

### Метод TAccountChecker::changePasswordInternal()
Этот метод реализует сам механизм смены пароля и имеет следующую ассигнатуру:

```php
protected function changePasswordInternal(string $newPassword) : boolean;
```
Вызов метода происходит только при успешном логине в аккаунт, то есть после успешной отработки методов `LoadLoginForm()` и `Login()`. При успешной смене пароля метод должен вернуть true, иначе будет выброшено исключение `EngineError`, в любых других случаях нужно выбрасывать исключени `CheckException` с необходимым сообщением и кодом ошибки - логика прежняя как и при проверке аккаунта. Необходимые данные для заполнения полей берем по-старому из массива TAccountChecker::$AccountFields.
Пример реализации для тестов можно всегда посмотреть тут:
[testprovider](https://github.com/AwardWallet/engine/blob/master/testprovider/Checker/ChangePassword.php)

### Метод TAccountChecker::generatePassword()

```php
protected function generatePassword() : string;
```
Этот метод реализует генерацию пароля случайным образом по требования сайта провайдера. Вызывается отдельными методами в случае, если пользователь или партнер хотят сгенерировать случайный пароль.