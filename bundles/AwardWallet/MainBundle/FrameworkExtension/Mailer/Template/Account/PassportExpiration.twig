{% extends '@MailTemplate/Layout/base.twig' %}
{% trans_default_domain "email" %}

{% block subject %}{% apply spaceless %}{% autoescape false %}
    {% set country = block('countryName') %}
    {% if country is empty %}
        {{ 'passport_expiration.subject'|trans({
            '%user_name%': passport.ownerFullName,
            '%months%': expiresInMonths
        }, 'email', lang)|desc("ðŸ›‚ %user_name%'s Passport Expires in %months% Months") }}
    {% else %}
        {{ 'passport_expiration.with_issuing_country.subject'|trans({
            '%user_name%': passport.ownerFullName,
            '%issuing_country%': country,
            '%months%': expiresInMonths
        }, 'email', lang)|desc("ðŸ›‚ %user_name%'s Passport (%issuing_country%) Expires in %months% Months") }}
    {% endif %}
{% endautoescape %}{% endapply %}{% endblock subject %}

{% block content %}
    {% import '@MailTemplate/CommonMacro.twig' as commonMacro %}

    {% set country = block('countryName') %}
    {% if country is empty %}
        {% set expiresIn = 'passport_expiration.expires_in'|trans({
            '%user_name%': passport.ownerFullName|htmlencode,
            '%months%': expiresInMonths,
            '%bold_on%': '<b>',
            '%bold_off%': '</b>'
        }, 'email', lang)|desc('According to our records, the passport, which belongs to %user_name%, %bold_on%expires in %months% months%bold_off%.') %}
    {% else %}
        {% set expiresIn = 'passport_expiration.with_issuing_country.expires_in'|trans({
            '%user_name%': passport.ownerFullName|htmlencode,
            '%months%': expiresInMonths,
            '%issuing_country%': country|htmlencode,
            '%bold_on%': '<b>',
            '%bold_off%': '</b>'
        }, 'email', lang)|desc('According to our records, the passport (issuing country: %issuing_country%), which belongs to %user_name%, %bold_on%expires in %months% months%bold_off%.') %}
    {% endif %}

    {{ commonMacro.paragraph(
        expiresIn ~ ' ' ~
        'passport_expiration.recommendation'|trans({}, 'email', lang)|desc("Typically, your passport should be valid for at least six months after your last day of travel. If you haven't already done so, we recommend that you start looking into getting this passport renewed now. Once you get your new passport, please update your records on AwardWallet so that we can continue monitoring your passport expiration date:"),
        _context, {escape: false}
    ) }}
    {% set link = baseUrl ~ path('aw_document_edit', {documentId: passport.id}) %}
    {{ commonMacro.dottedLink(link, link, _context) }}
{% endblock content %}

{% block restore_row %}
    {% if businessRecipient is null %}
        {{ parent() }}
    {% endif %}
{% endblock restore_row %}

{% block unsubscribe %}
    {% import '@MailTemplate/CommonMacro.twig' as commonMacro %}
    {{ commonMacro.familyMemberUnsubscribeLink(user, unsubscribeLink ~ '#rewardsExpiration', _context) }}
{% endblock unsubscribe %}

{% block countryName %}{% apply spaceless %}{% autoescape false %}
    {% set country = '' %}
    {% if passport.customFields.passport is defined %}
        {% set country = passport.customFields.passport.country|default('') %}
    {% endif %}
    {% if country is not empty %}
        {{ country|localizedCountryById(lang) }}
    {% endif %}
{% endautoescape %}{% endapply %}{% endblock countryName %}