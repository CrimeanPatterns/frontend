# Руководство для менеджеров

## Что нужно делать?

Проверять правильность собранных данных по лаунджам. 
Нужны 2 страницы:
1. Список лаунджей, которые нужно проверить. [Схему lounge](https://awardwallet.com/manager/list.php?Schema=Lounge) можно найти в меню менеджерки Misc -> Lounges.
2. Список "сырых" лаунджей, которые мы пытаемся соединить между собой с разных сайтов. [Схему lounge source](https://awardwallet.com/manager/list.php?Schema=LoungeSource) можно найти в меню менеджерки Misc -> Lounges Sources.

## Прежде чем приступить к проверке нужно понимать механизм сбора данных.

Есть несколько сайтов от куда мы собираем лаунджи. Список не конечный и в будущем может быть расширен. Собираем все начиная с названия и заканчивая часами работы и фотографиями. Каждый собранный лаундж записывается в LoungeSource. Можно их все увидеть в схеме `Lounges Sources`.

Сбор данных проходит в 2 этапа:
1. Непосредственный сбор и сохранение в LoungeSource со всех сайтов.
2. Слияние лаунджей и как результат этого слияния запись уже в Lounge.

### Этап №1 Сбор данных.

С ним все просто. Можно проверить корректность собранных данных и результат слияния. Об этом ниже.

### Этап №2 Слияние лаунджей.

Слияние происходит в автоматическом режиме. Ручного режима не существует. Если находится проблема, то ее нужно решать только настройкой процедуры слияния. 

В основе слияния лежит алгоритм, который сравнивает терминалы, в которых находятся лаунджи, а так же gates, которые расположены рядом. Имя лаунджа так же учитывается.

#### Пример 1:

С 2ух сайтов пришли лаунджи в аэропорте XXX:
- "VIP Business Lounge"
- "Business Lounge"

В данном случае мы считаем что это один и тот же лаундж потому, что информации о терминале нет (предполагаем терминал единственный) и о гейтах инфы нет, а имена похожи.

#### Пример 2:

- "VIP Lounge", терминал 2
- "Business Lounge", терминал не указан, гейт 5

Не считаем, что это один и тот же лаундж, потому что терминалы разные и гейты разные.

#### Пример 3:

С 3 сайтов 3 лаунджа в аэропорте XXX:

- "VIP Lounge", терминал 2
- "Business Lounge", терминал не указан, гейт 5
- "Business Lounge", терминал не указан, гейт 5

В данном случае мы видим 2 лаунджа. Первый - "VIP Lounge", второй - "Business Lounge" (терминалы и гейты сошлись)

#### Пример 4:

С одного сайта пришли 2 лаунджа в аэропорте XXX:

- "VIP Lounge", терминал 2, гейт 1
- "Business Lounge", терминал 2, гейт 2

Т.к. эти лаунджи пришли с одного сайта, то их нельзя соединять. Это 2 разных лаунджа.

Похожие лаунджи группируются и создается новый лаундж, свойства которого взяты c наиболее приоритетного лаунджа из группы. Далее отдельные свойства обновляются с отдельных лаунджей группы.

#### Как происходит обновление лаунджей?

Точно так же как описано выше. Только к сравнению лаунджей добавляются лаунджи из предыдущих слияний. 

Например из 2 лаунджей с сайтов:

- "Super Business Lounge", терминал 2, гейт 1
- "Business Lounge", терминал 2, гейт 1

был создан 1 лаундж:

- "Business Lounge", терминал 2, гейт 1

При повторном слиянии будут сравниваться не 2 лаунджа а 3:

- "Super Business Lounge", терминал 2, гейт 1 (с сайта)
- "Business Lounge", терминал 2, гейт 1 (с сайта)
- "Business Lounge", терминал 2, гейт 1 (из предыдущего слияния)

По итогу новый лаундж не будет создан, т.к. уже имеется. Он будет обновлен.

## Как проверить правильность слияния?

Основная проблема в сборе самых главных свойств terminal и gates. Зачастую из-за них ты будешь видеть очень похожие лаунджи из разных источников в схеме Lounge. Например, свойства 2 лаунджей одинаковы, но у одного терминал указан Main а у второго Domestic и гейты не указаны. В таком случае слияние не произойдет и будет 2 лаунджа вместо одного. Дубликаты так же показываются юзерам. Каждый новый лаундж как результат слияния по-умолчанию показывается юзеру. Нужно находить таких дубликаты, отписывать о них в кейсе и ставить им Visible = false. 

## Как проверить правильность сбора данных?

В каждом лаундже есть источники (сайты от куда собрана инфа). Можно перейти из схемы Lounge по ссылке и увидеть их все внутри схемы LoungeSource. И уже там убедиться, что все свойства собраны верно.
Что бы понимать какие лаунджи из схемы Lounge нуждаются в проверке нужно просто открыть список и сортировка по-умолчанию покажет те лаунджи, которые нуждаются в проверке. Нужные будут сверху и выделены желтым цветом. В колонке Sources может быть информация для вас, которая позволит оценить какие свойства и когда были обновлены. 

## Результаты проверки

В режиме редактирования Lounge снимать галку Visible, если есть ошибки в лаундже. После этого лаундж не будет показываться юзерам. Если с лаунджем все в порядке, то просто сабмитить форму дабы проставилось время последней проверки лаунджа и удалилась инфа для вас в колонке Sources.
Если отдельные свойства ошибочны, то можно исправить их и заморозить до починки парсера. Заморозка может быть автоматически снята в указанный вами день. Замораживаются только отдельные указанные вами свойства. Замороженные свойства не будут обновляться, но при изменениях, пришедших с парсера вам на почту придет уведомление. Далее вы можете вручную разморозить свойства и при следующем парсинге они будут обновлены. 